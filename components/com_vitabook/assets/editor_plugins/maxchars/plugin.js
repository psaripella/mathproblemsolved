tinymce.PluginManager.add("maxchars",function(e,t){function a(){e.theme.panel.find("#wordcount").text([o+" {0}",n.getCount()])}function f(){var e=navigator.userAgent.toLowerCase();return e.indexOf("msie")!=-1?parseInt(e.split("msie")[1]):false}var n=this,r,i,s,o,u;r=parseInt(e.getParam("max_chars"));i=e.getParam("max_chars_nospaces");s=e.getParam("max_chars_indicator");o=e.getParam("max_chars_text","");u=e.getParam("max_chars_maxText","");e.on("init",function(){var t=e.theme.panel&&e.theme.panel.find("#statusbar")[0];if(t){window.setTimeout(function(){t.insert({type:"label",name:"wordcount",text:[o+" {0}",n.getCount()],classes:"wordcount",disabled:e.settings.readonly},0);e.on("keyup change setcontent",function(e){a()})},0)}});n.getCount=function(){var t=e.getContent({format:"raw"});var n="";var s="";if(f()!==false){n=e.getBody().innerText.replace(/<\/?[^>]+(>|document.id)/g,"").replace(/&nbsp;/gi,"");s=e.getBody().innerHTML}else{n=e.getBody().textContent.replace(/<\/?[^>]+(>|document.id)/g,"").replace(/&nbsp;/gi,"");s=e.getBody().innerHTML}var o=n.replace(/<\/?[^>]+(>|document.id)/g,"");if(i==1)o=o.replace(/\s/g,"");if(r>0&&o.length>=0&&r<o.length&&this._MCtext!=n){e.setContent(this._MCtext)}else this._MCtext=s;var u=r-o.length;return u}})