/*
 Copyright (C) 2012. All rights reserved.
 @license     GNU General Public License version 2 or later; see LICENSE.txt
 @author      JoomVita - http://www.joomvita.com
 */
var vitabook={currentId:0,currentType:"none",reset:function(){document.id("vbMessageFormSubmitButton").disabled=!1;document.id("vbAjaxBusy").hide();if("edit"==vitabook.currentType){tinymce.get("jform_message").setContent(document.id("vbMessageMessage_"+vitabook.currentId).getFirst("div.vbMessageText").get("html"));var b=document.id("vbMessage_"+vitabook.currentId);document.id("jform_name").set("value",b.get("data-name"));document.id("jform_email").set("value",b.get("data-email"));document.id("jform_site")&&
document.id("jform_site").set("value",b.get("data-site"));document.id("jform_location")&&document.id("jform_location").set("value",b.get("data-location"))}else document.id("vitabookMessageForm").reset(),tinymce.get("jform_message").setContent(""),"reply"==vitabook.currentType&&(document.id("jform_parent_id").value=vitabook.currentId)},fresh:function(){if("fresh"!=vitabook.currentType){if("reply"==vitabook.currentType)document.id("jform_parent_id").value=1,tinymce.execCommand("mceRemoveEditor",!0,
    "jform_message"),document.id("vbFormHolder").grab(document.id("vbMessageForm")),vitabook.currentId=0;else if("none"!=vitabook.currentType){vitabook.cancel(vitabook.fresh);return}tinymce.execCommand("mceAddEditor",!0,"jform_message");document.id("vbMessageForm").reveal({duration:250});vitabook.currentType="fresh";var b=document.id("vbMessageForm").getPosition();window.scrollTo(b.x,b.y-100);vitabook.grabFocus()}},reply:function(b){if("fresh"==vitabook.currentType||"none"==vitabook.currentType)tinymce.execCommand("mceRemoveEditor",
    !0,"jform_message");else if("reply"==vitabook.currentType)tinymce.execCommand("mceRemoveEditor",!0,"jform_message");else if("none"!=vitabook.currentType){vitabook.cancel(vitabook.reply.bind(this,b));return}document.id("jform_parent_id").value=b;document.id("vbMessageChildren_"+b).adopt(document.id("vbMessageForm"));tinymce.execCommand("mceAddEditor",!0,"jform_message");document.id("vbMessageForm").reveal({duration:250});var a=document.id("vbMessageForm").getPosition();window.scrollTo(a.x,a.y);vitabook.grabFocus();
    vitabook.currentId=b;vitabook.currentType="reply"},edit:function(b){if("none"==vitabook.currentType){tinymce.execCommand("mceRemoveEditor",!0,"jform_message");var a=document.id("vbMessage_"+b).getFirst("div.vbMessageText").get("html");document.id("jform_message").set("value",a);a=document.id("vbMessage_"+b);document.id("jform_name").set("value",a.get("data-name"));document.id("jform_email").set("value",a.get("data-email"));document.id("jform_site")&&document.id("jform_site").set("value",a.get("data-site"));
    document.id("jform_location")&&document.id("jform_location").set("value",a.get("data-location"));document.id("jform_parent_id").set("value",a.get("data-parent_id"));document.id("vbMessage_"+b).getParent().grab(document.id("vbMessageForm"),"top");(function(){tinymce.execCommand("mceAddEditor",!0,"jform_message")}).delay(50);document.id("jform_id").set("value",b);document.id("vbMessage_"+b).hide();document.id("vbMessageForm").reveal({duration:250});vitabook.currentId=b;vitabook.currentType="edit"}else vitabook.cancel(vitabook.edit.bind(this,
    b))},cancel:function(b){var a=0;switch(vitabook.currentType){case "edit":document.id("vbMessageForm").hide();document.id("vbMessage_"+vitabook.currentId).set("opacity",.5);document.id("vbMessage_"+vitabook.currentId).show();Browser.ie&&9>Browser.version?document.id("vbMessage_"+vitabook.currentId).set("opacity",1):document.id("vbMessage_"+vitabook.currentId).tween("opacity",1);document.id("vitabookMessageForm").reset();break;case "reply":document.id("vbMessageForm").hide();document.id("jform_parent_id").value=
    1;break;case "fresh":document.id("vbMessageForm").dissolve({duration:250}),a=200}(function(){tinymce.execCommand("mceRemoveEditor",!0,"jform_message");document.id("jform_id").value=0;document.id("jform_message").set("value","");document.id("vbMessageFormSubmitButton").disabled=!1;document.id("vbAjaxBusy").hide();document.id("vbFormHolder").grab(document.id("vbMessageForm"));vitabook.currentId=0;vitabook.currentType="none";b&&b();"undefined"!=typeof Recaptcha&&Recaptcha.reload()}).delay(a)},loadChildren:function(b,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         a,c){(new Request.HTML({url:vitabook.url_base,onRequest:function(){document.id("vbLoadMoreMessages_"+a+"_"+c).set("opacity",.5);document.id("vbLoadMoreMessages_"+a+"_"+c).set("onclick","")},onComplete:function(b){document.id("vbLoadMoreMessages_"+a+"_"+c).destroy();var e=document.id("vbMessageChildren_"+a).getChildren("div");document.id("vbMessageChildren_"+a).adopt(b);document.id("vbMessageChildren_"+a).adopt(e)}})).get("task=vitabook.getMessages&start="+c+"&format=raw&"+vitabook.token+"=1&parent_id="+
    a)},state:function(b,a){var c="unpublish";if(0==document.id("vbMessage_"+a).get("data-published")||document.id("vbMessageTop_"+a).hasClass("vbMessageUnActivated"))c="publish";(new Request.JSON({url:vitabook.url_base,onSuccess:function(b){1===b.success?(document.id("vbMessage_"+a).set("data-published",b.state),document.id("vbMessageStateControl_"+a).src=b.state?document.id("vbMessageStateControl_"+a).src.replace("offline","online"):document.id("vbMessageStateControl_"+a).src.replace("online","offline"),
    vitabook.visualState(a,b.state)):alert(b.state)}})).get("task=message."+c+"&messageId="+a+"&"+vitabook.token+"=1&format=raw")},remove:function(b,a){(new Request.JSON({url:vitabook.url_base,onSuccess:function(b){1===b.success?(document.id("vbMessageTop_"+a).getParent().dissolve({duration:250}),function(){document.id("vbMessageTop_"+a).getParent().destroy()}.delay(250)):alert(b.state)}})).get("task=message.delete&messageId="+a+"&"+vitabook.token+"=1&format=raw")},save:function(b){tinyMCE.triggerSave();
    vitabook.validate()?(new Request.JSON({url:vitabook.url_base,method:"post",data:document.id("vitabookMessageForm"),onSuccess:function(a){switch(a.state){case 1:"edit"==vitabook.currentType?((new Request.HTML({url:vitabook.url_base,onSuccess:function(b,d){var e=document.id("vbMessageTop_"+a.result).getParent(),f=document.id("vbMessageChildren_"+a.result).getChildren("div"),g=d.getElement("#vbMessageTop_"+a.result);document.id("vbMessageTop_"+a.result).destroy();e.adopt(g);document.id("vbMessageChildren_"+
        a.result).adopt(f)}})).get("task=message.getMessage&format=raw&messageId="+a.result+"&"+vitabook.token+"=1"),vitabook.cancel()):("fresh"==vitabook.currentType&&(new Request.HTML({url:vitabook.url_base,onComplete:function(a){var b=document.id("vbMessages").getChildren("div");document.id("vbMessages").adopt(a);document.id("vbMessages").adopt(b);vitabook.cancel();document.id("vbNoMessages")&&document.id("vbNoMessages").destroy()}})).get("task=message.getMessage&format=raw&messageId="+a.result+"&"+vitabook.token+
        "=1"),"reply"==vitabook.currentType&&(new Request.HTML({url:vitabook.url_base,onComplete:function(a){document.id("vbMessageChildren_"+vitabook.currentId).adopt(a);vitabook.cancel()}})).get("task=message.getMessage&format=raw&messageId="+a.result+"&"+vitabook.token+"=1"));break;case 2:vitabook.cancel();(function(){alert(a.result)}).delay(260);break;case 0:alert(a.result),"undefined"!=typeof Recaptcha&&Recaptcha.reload(),document.id("vbMessageFormSubmitButton").disabled=!1,document.id("vbAjaxBusy").hide()}}})).send():
        (document.id("vbMessageFormSubmitButton").disabled=!1,document.id("vbAjaxBusy").hide());return!1},grabFocus:function(){""==document.id("jform_name").value?document.id("jform_name").focus():function(){tinyMCE.execCommand("mceFocus",!1,"jform_message")}.delay(100)},visualState:function(b,a){if(0==a)document.id("vbMessageTop_"+b).getParent().getElements("div.vbMessageTop").each(function(a){a.addClass("vbMessageUnpublished")});else if(document.id("vbMessageTop_"+b).hasClass("vbMessageUnActivated")){var c=
    document.id("vbMessageTop_"+b);c.removeClass("vbMessageUnActivated");var d=document.id("vbMessage_"+b).get("data-parent_id");document.id("vbMessageTop_"+d).hasClass("vbMessageUnpublished")&&c.addClass("vbMessageUnpublished")}else document.id("vbMessage_"+b).getParent().getElements("div[class^=vbMessageInner]").each(function(a){1!=a.get("data-published")||null!==document.id("vbMessageTop_"+a.get("data-parent_id"))&&document.id("vbMessageTop_"+a.get("data-parent_id")).hasClass("vbMessageUnpublished")||
a.getParent().removeClass("vbMessageUnpublished")})}};