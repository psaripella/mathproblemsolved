<?php
/*
	JoomlaXTC Reading List

	version 1.3.1
	
	Copyright (C) 2012,2013 Monev Software LLC.	All Rights Reserved.
	
	This program is free software; you can redistribute it and/or modify
	it under the terms of the GNU General Public License as published by
	the Free Software Foundation; either version 2 of the License, or
	(at your option) any later version.
	
	This program is distributed in the hope that it will be useful,
	but WITHOUT ANY WARRANTY; without even the implied warranty of
	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
	GNU General Public License for more details.
	
	You should have received a copy of the GNU General Public License
	along with this program; if not, write to the Free Software
	Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
	
	THIS LICENSE IS NOT EXTENSIVE TO ACCOMPANYING FILES UNLESS NOTED.

	See COPYRIGHT.php for more information.
	See LICENSE.php for more information.
	
	Monev Software LLC
	www.joomlaxtc.com
*/

defined( '_JEXEC' ) or die;

JHTML::_('behavior.tooltip');
?>
<div class="readinglist-list<?php echo (isset($this->pageclass_sfx) ? $this->pageclass_sfx : ''); ?>">
	<?php if ($this->params->get('show_page_heading', 1)) { ?>
		<h1>
			<?php if ($this->escape($this->params->get('page_heading'))) :?>
				<?php echo $this->escape($this->params->get('page_heading')); ?>
			<?php else : ?>
				<?php echo $this->escape($this->params->get('page_title')); ?>
			<?php endif; ?>
		</h1>
	<?php }

		if (empty($this->items)) {
			echo JText::_('RL_NOITEMS');
		}
		else {
			echo '<div class="readinglist_options">';
			?>
			<div class="row-fluid rlactionbar" style="vertical-align:top">
				<form action="index.php" method="post" name="readingListForm" id="readingListForm" class="span6">
				  <input type="hidden" name="task" value="" />
				  <input type="hidden" name="view" value="readinglist" />
				  <input type="hidden" name="option" value="com_jxtcreadinglist" />
					<?php echo $this->categorySelector; ?>
				  <?php echo JHTML::_('form.token'); ?>
				</form>
				<?php
					if ($this->params->get('showshare',1)) {
						$onclick = "window.open(this.href,'rlcopy','width=700,height=400,menubar=no,resizable=yes'); return false;";
						$link = 'index.php?option=com_jxtcreadinglist&tmpl=component&view=copy&cid='.$this->cid;
		
						echo '<a class="rl_link rlcopy" href="'.$link.'" title="'.JText::_('RL_COPYTIP').'" onclick="'.$onclick.'">';
						echo '<i class="rlicon-paste"></i> '.JText::_('RL_COPY');
						echo '</a>';
					}
		
					if ($this->params->get('showemail',1)) {
						require_once JPATH_SITE . '/components/com_mailto/helpers/mailto.php';
		
						$mailLink = jxtcrlhelper::getEmailLink($this->cid);
						$onclick = "window.open(this.href,'rlemail','width=400,height=350,menubar=no,resizable=yes'); return false;";
						$link	= 'index.php?option=com_mailto&tmpl=component&link='.MailToHelper::addLink($mailLink);
		
						echo '<a class="rl_link rlemail" href="'.$link.'" title="'.JText::_('RL_EMAILTIP').'" onclick="'.$onclick.'">';
						echo '<i class="rlicon-mail"></i> '.JText::_('RL_EMAIL');
						echo '</a>';
						
					}
				?>
			</div>
			<div style="clear:both"></div>
			<?php
			$categories = array_keys($this->items);
			sort($categories);

			echo JHtml::_('bootstrap.startAccordion', 'readinglist');
			foreach ($categories as $category) {
				?><div class="category_title"><?php
					echo $category;
				?></div><?php
	
				foreach ($this->items[$category] as $item) {
					$itemdate = isset($item->published) ? $item->published : $item->modified; 
					$title = $item->title.'<i class="rlicon-toggle pull-right"></i><div class="header_date"><span class="author">'.JText::sprintf('RL_TBAUTHOR',$item->author).'</span><span class="date">'.JHtml::_('Date',$item->modified,JText::_('RL_TBDATE')).'</span></div>';
					?>
						<div class="accordion-group">
							<div class="accordion-heading">
								<div class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#readinglist" href="#entry<?php echo $item->id; ?>">
									<?php echo $title; ?>
								</div>
							</div>

							<div id="entry<?php echo $item->id; ?>" class="accordion-body collapse">
								<div class="accordion-inner">
									<div class="rlcontent">
										<?php require 'default_'.$item->component.'.php'; ?>
									</div>
								</div>
							</div>

						</div>
					<?php
				}
			}
			echo JHtml::_('bootstrap.endAccordion');
		}
	?>
</div>
		
